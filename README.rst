=======
pycorec
=======

| 連番画像ピクセル座標取得プログラム(pycorec)
| Version 1.0.7 (2022-06-10)

How to use
--------
| 使い方
0. 本ソフトウェアはファイル名に連番が付与された時系列画像ファイル(***_0001.jpg,***_0002.jpg,...等)を想定して作成されています。

1. Pycharmで本スクリプトを開き，スクリプト上で右クリックして，Run File in Python Consoleを選択します。

2. pycorecのウィンドウが立ち上がります。まず読み込む画像についての情報を入力してください。

* 画像時空間パラメーターの指定(オプション項目)

  i. 画像の相対時刻を記録したい場合，「フレームレート(fps)」の横のテキストボックスに自然数で値を入力してください。
      fpsは何枚の画像で1秒間の動画が構成されるかを示す値です。画像の時刻情報が必要ない場合は，空欄のままで結構です。

  ii. 画像座標から実空間物理座標への変換を行いたい場合「物理座標変換スケール(cm/px)」の横のテキストボックスに小数で値を入力してください。
       画像座標(px)で出力する場合は，空欄のままで結構です。

* 画像読み込みパラメーターの指定(必須項目)

  iii.「画像の表示倍率」の横のテキストボックスに小数で表示倍率を入力してください。(初期値は0.5)
       本来の画像サイズで表示すると画面に収まらない事が多いため，アスペクト比(縦横比)を維持したまま縮小表示を行う必要があります。

  iv.「フレームインターバル」の横のテキストボックスに自然数でフレームインターバル(表示する画像の間隔)を入力してください。
    初期値は1が設定されており，この場合読み込み対象の全画像を読み込みます。

     | 例)001-010までの連番画像について
     * 読み込みたい画像が001,003,005の場合インターバル=2, 001,004,007の場合インターバル=3を指定


3.画像読込の方法のうち1つをボタンクリックにより選択します。
    1. 指定したフォルダ内の全画像からインターバルに従って読み込むモード **「フォルダ選択(フォルダ内画像一括選択)」**
    2. ファイル選択画面で指定した同一フォルダ内の連続した1つの範囲の画像からインターバルに従って読み込むモード **「ファイル選択(連続範囲選択)」**
    3. ファイル選択画面で画像を複数選択によって直接指定して読み込むモード **「ファイル選択(複数・任意選択可能)」**

* AとBについて事前に指定したフレームインターバルが適用されます。Cには適用されません。

   * 例)インターバル=1で1.「フォルダ選択(フォルダ内画像一括選択)」を選択した場合，フォルダ内の全画像が読み込まれます。
   * 例)インターバル=1で2.「ファイル選択(連続範囲選択)」を選択した場合，指定した全画像が読み込まれます。
   * 例)インターバル=2で1.「フォルダ選択(フォルダ内画像一括選択)」を選択した場合，フォルダ内の連番の最小画像から1つおきに画像が読み込まれます。
   * 例)インターバル=2で2.「ファイル選択(連続範囲選択)」を選択した場合，指定した画像のうち連番の最小画像から1つおきに画像が読み込まれます。

4.画像は連番の小さい順に読み込まれ，1枚ずつ表示されます。

* 画像座標系では左上が(0,0)で，右に行くほどx座標が増加し，下に行くほどy座標が増加します。
* マウスを動かすと十字で画像上の位置が示され，左上に(x,y)のピクセル座標が表示されます。

座標記録

* 画像上で **左クリック** を行うと座標記録ができます。複数点記録することも可能です。各画像1点目は必ず記録が必要です。記録しないと遷移しません。

座標削除

*  **右クリック** するとその回数分だけ遡って同画像の記録座標を削除します。画像を遡って削除が進行することはありません

次の画像に移動

* 次の画像に移行したいときは， **右矢印キー(→)** を押してください(キー入力を検知しているためどのキーを押しても同様に反応します)。

強制終了

* 途中で記録処理を強制終了したい場合は **マウスホイール** を押し込んでください。ウィンドウを閉じても次の画像が開くため終了できません。
* 強制終了時にcsv出力保存先の選択画面が表示されます。途中経過を保存したい場合は「保存」を，破棄して終了したい場合は「キャンセル」を押してください。

5.全画像記録し終えると，画像ウィンドウが表示されなくなり,csvファイルの保存先選択画面が表示されます。

* 座標データを記録したcsvファイルの保存先とファイル名を指定してください。
* 「保存」を押すと出力処理は完了です。
* 誤ってキャンセルを押してしまった場合「csv保存」ボタンを押すことで再度保存を行うことができます。

Release
--------
* Version 1.0.7 (2022-06-09)

  * 画像の表示倍率を座標値cmに反映するように修正
* Version 1.0.6 (2022-02-04)

  * 2枚目以降の画像は1画像につき1点は必ず記録しないとキーを押しても次の画像に遷移しないように変更。
* Version 1.0.5 (2022-02-03)

  * フレームレート(fps)，物理座標変換スケール(cm/px)の値を入力する機能を追加し，座標(cm)と相対時刻(s)の出力機能を追加
  * 読み込みモードをA「フォルダ選択(フォルダ内画像一括選択)」,B「ファイル選択(連続範囲選択)」,C「ファイル選択(複数・任意選択可能)」に変更。
* Version 1.0.4 (2022-02-02)

  * 画像クリック時に表示されるデータフレームの行数を前後3行，列数を6行(3点のx,y)のみに限定
  * フレームインターバルの指定による間隔を開けた画像の読み込みをAに加えてBのフォルダ内任意の連続範囲についても可能とした。
* Version 1.0.3 (2022-02-01)

  * 「Bkg」をファイル名に含む画像を読み込まないように変更
  * 強制終了前にcsv保存できるように変更
  * 全画像表示終了後にcsv保存画面が表示されるように変更
  * インターバルの仕様を変更 例)読み込みたい画像が001,003,005の場合インターバル＞2
* Version 1.0.2 (2022-02-01)

  * 日本語が含まれるファイルパスに対応(Numpyを経由して読み込むように変更)
  * リアルタイムマウス位置画像座標表示機能の追加
  * 画像スキップ読込モードを追加
  * 画像の表示倍率を指定する機能を追加
* Version 1.0.1 (2022-01-28)

  * フォルダ内の全画像を読み込むモード「画像フォルダ選択」に加えて，
  * 任意の複数画像を指定して読み込むモード「画像ファイル指定(複数選択可)」を追加。
  * 画像座標の単位を(px)として記載
  * 対象画像ファイル名をデータフレームの列として追加
  * 出力CSVファイルのファイル名を指定できるように変更。
* Version 1.0.0 (2022-01-28)

  * 初期リリース












Future update
--------

* 追加予定機能
* 画像中一点目の時系列座標グラフ出力
* 物理座標系においてy軸正の向きを反転する機能
* Cモードでの相対時刻記録
* リアルタイム記録座標表示機能(Pycharmを利用せずに実行できるように.exe化)
* フレーム数タイムクリック数フレームインターバルフレームレートタイムインターバル表示
* 動画avi読み込み

Credits
-------
| Managed by TAKAGI Tsutomu's laboratory (Faculty of Fisheries Sciences, Hokkaido Univ.)
| Programmed by TANAKA Yuto (Graduate school of Fisheries Sciences, Hokkaido Univ.)

| Development environment
* Python 3.9.4
* opencv-python 4.5.5.62
* natsort 8.0.2
* numpy 1.22.1
* pandas 1.4.0
* Pycharm Professional 2021.3.1
* CPU   Intel(R) Core(TM) i7-8650U CPU @ 1.90GHz   2.11 GHz
* RAM   8.00 GB
* OS    Windows 11 Home 21H2

This package was created with Cookiecutter_ and the `audreyr/cookiecutter-pypackage`_ project template.

.. _Cookiecutter: https://github.com/audreyr/cookiecutter
.. _`audreyr/cookiecutter-pypackage`: https://github.com/audreyr/cookiecutter-pypackage
